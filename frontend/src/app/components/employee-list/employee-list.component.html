<div class="employee-list-container">
  <!-- Header -->
  <div class="list-header">
    <div class="header-top">
      <h2>Quản lý Nhân viên</h2>
      <div class="header-buttons">
        <button class="btn btn-secondary" (click)="navigateToSalary()" title="Quản lý lương nhân viên">
          <i class="fas fa-dollar-sign"></i> Quản lý Lương
        </button>
        <button class="btn btn-primary" (click)="createEmployee()">
          <i class="fas fa-plus"></i> Thêm Nhân viên
        </button>
      </div>
    </div>

    <!-- Search and Filters -->
    <div class="filters-section">
      <div class="search-box">
        <input
          type="text"
          placeholder="Tìm kiếm theo tên, số điện thoại hoặc mã nhân viên..."
          [(ngModel)]="filter.search"
          (input)="onSearch()"
          class="search-input"
        />
        <button class="search-btn" (click)="onSearch()">
          <i class="fas fa-search"></i>
        </button>
      </div>

      <div class="filters-row">
        <div class="filter-group">
          <label>Chi nhánh:</label>
          <select [(ngModel)]="filter.maChiNhanh" (change)="onFilterChange()" class="filter-select">
            <option value="">Tất cả chi nhánh</option>
            <option *ngFor="let branch of branches" [value]="branch.MaChiNhanh">
              {{ branch.TenChiNhanh }}
            </option>
          </select>
        </div>

        <div class="filter-group">
          <label>Loại nhân viên:</label>
          <select [(ngModel)]="filter.loaiNhanVien" (change)="onFilterChange()" class="filter-select">
            <option value="">Tất cả loại</option>
            <option *ngFor="let type of employeeTypes" [value]="type.LoaiNhanVien">
              {{ type.LoaiNhanVien }}
            </option>
          </select>
        </div>

        <button class="btn btn-secondary" (click)="clearFilters()">
          <i class="fas fa-times"></i> Xóa bộ lọc
        </button>
      </div>
    </div>

    <!-- Bulk Actions -->
    <div class="bulk-actions" *ngIf="showBulkActions" [@slideIn]>
      <div class="bulk-info">
        <strong>{{ selectedEmployees.size }} nhân viên được chọn</strong>
      </div>

      <div class="bulk-controls">
        <select [(ngModel)]="bulkBranch" class="filter-select">
          <option value="">Chọn chi nhánh để chuyển</option>
          <option *ngFor="let branch of branches" [value]="branch.MaChiNhanh">
            {{ branch.TenChiNhanh }}
          </option>
        </select>

        <button class="btn btn-success" (click)="bulkAssignBranch()" [disabled]="!bulkBranch">
          <i class="fas fa-exchange-alt"></i> Chuyển Chi nhánh
        </button>
      </div>
    </div>

    <!-- Error Message -->
    <div class="error-message" *ngIf="error">
      <i class="fas fa-exclamation-circle"></i>
      {{ error }}
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading">
    <div class="skeleton-header"></div>
    <div class="skeleton-row" *ngFor="let i of [1, 2, 3, 4, 5]"></div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!loading && employees.length === 0">
    <i class="fas fa-inbox"></i>
    <p>Không tìm thấy nhân viên nào</p>
  </div>

  <!-- Employees Table -->
  <div class="table-wrapper" *ngIf="!loading && employees.length > 0">
    <table class="employees-table">
      <thead>
        <tr>
          <th class="checkbox-col">
            <input
              type="checkbox"
              (change)="toggleSelectAll($event)"
              [checked]="selectedEmployees.size === employees.length && employees.length > 0"
            />
          </th>
          <th class="sortable" (click)="onSortChange('MaNhanVien')">
            Mã NV
            <span class="sort-icon">{{ getSortIcon('MaNhanVien') }}</span>
          </th>
          <th class="sortable" (click)="onSortChange('HoTen')">
            Họ Tên
            <span class="sort-icon">{{ getSortIcon('HoTen') }}</span>
          </th>
          <th class="sortable" (click)="onSortChange('SDT')">
            Số Điện Thoại
            <span class="sort-icon">{{ getSortIcon('SDT') }}</span>
          </th>
          <th>Loại Nhân viên</th>
          <th class="sortable" (click)="onSortChange('MaChiNhanh')">
            Chi Nhánh
            <span class="sort-icon">{{ getSortIcon('MaChiNhanh') }}</span>
          </th>
          <th>Khoa</th>
          <th class="sortable" (click)="onSortChange('LuongCoBan')">
            Lương
            <span class="sort-icon">{{ getSortIcon('LuongCoBan') }}</span>
          </th>
          <th class="sortable" (click)="onSortChange('NgayVaoLam')">
            Ngày Vào Làm
            <span class="sort-icon">{{ getSortIcon('NgayVaoLam') }}</span>
          </th>
          <th class="actions-col">Thao Tác</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let employee of employees" [class.selected]="isSelected(employee.MaNhanVien)">
          <td class="checkbox-col">
            <input
              type="checkbox"
              [checked]="isSelected(employee.MaNhanVien)"
              (change)="toggleSelection(employee.MaNhanVien)"
            />
          </td>
          <td><strong>{{ employee.MaNhanVien }}</strong></td>
          <td>{{ employee.HoTen }}</td>
          <td>{{ employee.SDT }}</td>
          <td>
            <span class="badge" [ngClass]="'badge-' + employee.LoaiNhanVien?.toLowerCase()?.replace(' ', '-')">
              {{ employee.LoaiNhanVien }}
            </span>
          </td>
          <td>{{ employee.MaChiNhanh }}</td>
          <td>{{ employee.MaKhoa }}</td>
          <td class="salary" title="{{ employee.LuongCoBan }}">
            {{ formatCurrency(employee.LuongCoBan || 0) }}
          </td>
          <td>{{ formatDate(employee.NgayVaoLam) }}</td>
          <td class="actions">
            <button
              class="btn btn-sm btn-info"
              (click)="viewEmployee(employee.MaNhanVien)"
              title="Xem chi tiết"
            >
              <i class="fas fa-eye"></i>
            </button>
            <button
              class="btn btn-sm btn-warning"
              (click)="editEmployee(employee.MaNhanVien)"
              title="Chỉnh sửa"
            >
              <i class="fas fa-edit"></i>
            </button>
            <button
              class="btn btn-sm btn-danger"
              (click)="deleteEmployee(employee)"
              title="Xóa"
            >
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="pagination-section" *ngIf="!loading && employees.length > 0">
    <div class="pagination-info">
      Hiển thị {{ (filter.page - 1) * filter.limit + 1 }} đến
      {{ Math.min(filter.page * filter.limit, totalItems) }} trong {{ totalItems }} nhân viên
    </div>

    <div class="pagination-controls">
      <div class="page-size-selector">
        <label>Hiển thị:</label>
        <select [(ngModel)]="filter.limit" (change)="onPageSizeChange()" class="page-size">
          <option [value]="10">10 / trang</option>
          <option [value]="20">20 / trang</option>
          <option [value]="50">50 / trang</option>
          <option [value]="100">100 / trang</option>
        </select>
      </div>

      <div class="pagination-buttons">
        <!-- First Page -->
        <button
          class="pagination-btn"
          (click)="onPageChange(1)"
          [disabled]="filter.page === 1"
          title="Trang đầu tiên"
        >
          <i class="fas fa-step-backward"></i>
        </button>

        <!-- Previous Page -->
        <button
          class="pagination-btn"
          (click)="onPageChange(filter.page - 1)"
          [disabled]="filter.page === 1"
          title="Trang trước"
        >
          <i class="fas fa-chevron-left"></i>
        </button>

        <!-- Page Numbers -->
        <button
          *ngFor="let page of getPageNumbers()"
          class="pagination-btn page-number"
          [class.active]="page === filter.page"
          (click)="onPageChange(page)"
        >
          {{ page }}
        </button>

        <!-- Next Page -->
        <button
          class="pagination-btn"
          (click)="onPageChange(filter.page + 1)"
          [disabled]="filter.page === totalPages"
          title="Trang sau"
        >
          <i class="fas fa-chevron-right"></i>
        </button>

        <!-- Last Page -->
        <button
          class="pagination-btn"
          (click)="onPageChange(totalPages)"
          [disabled]="filter.page === totalPages"
          title="Trang cuối cùng"
        >
          <i class="fas fa-step-forward"></i>
        </button>
      </div>
    </div>
  </div>
</div>
