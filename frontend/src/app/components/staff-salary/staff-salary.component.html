<div class="salary-management-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1> Qu·∫£n L√Ω L∆∞∆°ng Nh√¢n Vi√™n</h1>
      <p class="subtitle">C·∫≠p nh·∫≠t v√† theo d√µi thay ƒë·ªïi l∆∞∆°ng c·ªßa t·∫•t c·∫£ lo·∫°i nh√¢n vi√™n</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-refresh" (click)="refreshData()" [disabled]="loading">
         L√†m m·ªõi
      </button>
      <button class="btn btn-secondary" routerLink="/admin/staff">
        ‚Üê Quay l·∫°i
      </button>
    </div>
  </div>

  <!-- Success/Error Messages -->
  <div class="alert alert-success" *ngIf="successMessage">
    ‚úÖ {{successMessage}}
  </div>
  <div class="alert alert-error" *ngIf="error">
    ‚ö†Ô∏è {{error}}
  </div>

  <!-- Statistics Overview -->
  <div class="statistics-overview" *ngIf="!loading && employeeTypes.length > 0">
    <div class="stat-card">
      <div class="stat-icon">üë•</div>
      <div class="stat-details">
        <div class="stat-value">{{statistics?.totalEmployees || 0}}</div>
        <div class="stat-label">T·ªïng nh√¢n vi√™n</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-details">
        <div class="stat-value">{{employeeTypes.length}}</div>
        <div class="stat-label">Lo·∫°i nh√¢n vi√™n</div>
      </div>
    </div>
    <div class="stat-card highlight">
      <div class="stat-details">
        <div class="stat-value">{{formatCurrencyShort(getTotalPayroll())}}</div>
        <div class="stat-label">T·ªïng qu·ªπ l∆∞∆°ng</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-details">
        <div class="stat-value">{{formatCurrencyShort(getAverageSalary())}}</div>
        <div class="stat-label">L∆∞∆°ng trung b√¨nh</div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading">
    <div class="spinner"></div>
    <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
  </div>

  <!-- Main Content -->
  <div class="salary-content" *ngIf="!loading">
    <!-- Tab Navigation -->
    <div class="tab-navigation">
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'update'"
        (click)="switchTab('update')">
         C·∫≠p nh·∫≠t l∆∞∆°ng
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'bulk'"
        (click)="switchTab('bulk')">
         C·∫≠p nh·∫≠t h√†ng lo·∫°t
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'history'"
        (click)="switchTab('history')">
         L·ªãch s·ª≠ thay ƒë·ªïi ({{salaryHistory.length}})
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'statistics'"
        (click)="switchTab('statistics')">
         Th·ªëng k√™ chi ti·∫øt
      </button>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
      <!-- UPDATE TAB -->
      <div class="tab-panel" *ngIf="activeTab === 'update'">
        <div class="salary-grid">
          <!-- Current Salaries List -->
           
          <div class="salary-section salaries-list">
            <h3> B·∫£ng l∆∞∆°ng hi·ªán t·∫°i</h3>
            <div class="section-header">
              <div class="list-controls">
                <input 
                  type="text" 
                  [(ngModel)]="searchTerm" 
                  placeholder="T√¨m lo·∫°i nh√¢n vi√™n..."
                  class="search-input">
                <select [(ngModel)]="sortBy" (change)="changeSorting(sortBy)" class="sort-select">
                  <option value="type">S·∫Øp x·∫øp theo t√™n</option>
                  <option value="salary">S·∫Øp x·∫øp theo l∆∞∆°ng</option>
                  <option value="employees">S·∫Øp x·∫øp theo s·ªë NV</option>
                </select>
              </div>
            </div>
            
            <div class="salary-list">
              <div class="salary-item" 
                   *ngFor="let type of getSortedEmployeeTypes()"
                   [class.selected]="selectedType === type.loaiNhanVien"
                   (click)="onTypeSelect(type.loaiNhanVien)">
                <div class="item-header">
                  <strong class="type-name">{{type.loaiNhanVien}}</strong>
                  <span class="employee-count" *ngIf="statistics">
                    {{getEmployeeCount(type.loaiNhanVien)}} NV
                  </span>
                </div>
                <div class="salary-value">{{formatCurrency(type.luong)}}</div>
              </div>
              
              <div class="empty-state" *ngIf="getSortedEmployeeTypes().length === 0">
                Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£
              </div>
            </div>
          </div>

          <!-- Update Form -->
          <div class="salary-section update-form">
            <h3> C·∫≠p nh·∫≠t l∆∞∆°ng ƒë∆°n l·∫ª</h3>
            
            <form class="form-content" (ngSubmit)="updateSalary()">
              <div class="form-group">
                <label class="form-label required">Lo·∫°i nh√¢n vi√™n</label>
                <select 
                  [(ngModel)]="selectedType" 
                  name="selectedType"
                  (change)="onTypeSelect(selectedType)"
                  class="form-control"
                  [class.error]="hasValidationError('selectedType')"
                  required>
                  <option value="">-- Ch·ªçn lo·∫°i nh√¢n vi√™n --</option>
                  <option *ngFor="let type of employeeTypes" [value]="type.loaiNhanVien">
                    {{type.loaiNhanVien}} ({{formatCurrencyShort(type.luong)}})
                  </option>
                </select>
                <span class="error-text" *ngIf="hasValidationError('selectedType')">
                  {{getValidationError('selectedType')}}
                </span>
              </div>

              <div class="current-salary-display" *ngIf="selectedType">
                <div class="label">L∆∞∆°ng hi·ªán t·∫°i:</div>
                <div class="value">
                  {{formatCurrency(getSelectedSalary())}}
                </div>
              </div>

              <div class="form-group">
                <label class="form-label required">L∆∞∆°ng m·ªõi (VNƒê)</label>
                <input 
                  type="number" 
                  [(ngModel)]="newSalary" 
                  name="newSalary"
                  class="form-control"
                  [class.error]="hasValidationError('newSalary')"
                  min="0"
                  step="100000"
                  placeholder="Nh·∫≠p l∆∞∆°ng m·ªõi..."
                  required>
                <span class="error-text" *ngIf="hasValidationError('newSalary')">
                  {{getValidationError('newSalary')}}
                </span>
              </div>

              <!-- Salary Change Preview -->
              <div class="change-preview" *ngIf="selectedType && newSalary > 0">
                <div class="preview-row">
                  <span>Ch√™nh l·ªách:</span>
                  <strong [class.positive]="isPositiveChange(getSelectedSalary(), newSalary)"
                          [class.negative]="isNegativeChange(getSelectedSalary(), newSalary)">
                    {{formatCurrency(calculateDifference(getSelectedSalary(), newSalary))}}
                  </strong>
                </div>
                <div class="preview-row">
                  <span>Ph·∫ßn trƒÉm:</span>
                  <strong [class.positive]="isPositiveChange(getSelectedSalary(), newSalary)"
                          [class.negative]="isNegativeChange(getSelectedSalary(), newSalary)">
                    {{formatPercentage(calculatePercentageChange(getSelectedSalary(), newSalary))}}
                  </strong>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">L√Ω do thay ƒë·ªïi (t√πy ch·ªçn)</label>
                <textarea 
                  [(ngModel)]="updateReason" 
                  name="updateReason"
                  class="form-control"
                  rows="3"
                  placeholder="Nh·∫≠p l√Ω do thay ƒë·ªïi l∆∞∆°ng..."></textarea>
              </div>

              <div class="form-actions">
                <button 
                  type="button" 
                  class="btn btn-outline"
                  (click)="resetUpdateForm()"
                  [disabled]="submitting">
                   ƒê·∫∑t l·∫°i
                </button>
                <button 
                  type="submit" 
                  class="btn btn-primary"
                  [disabled]="submitting || !selectedType || !newSalary">
                  <span *ngIf="!submitting"> C·∫≠p nh·∫≠t l∆∞∆°ng</span>
                  <span *ngIf="submitting">
                    <span class="spinner-small"></span> ƒêang x·ª≠ l√Ω...
                  </span>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- BULK UPDATE TAB -->
      <div class="tab-panel" *ngIf="activeTab === 'bulk'">
        <div class="bulk-update-container">
          <div class="info-banner">
            <span class="icon"></span>
            <div class="info-text">
              <strong>C·∫≠p nh·∫≠t h√†ng lo·∫°t</strong> cho ph√©p b·∫°n tƒÉng ho·∫∑c gi·∫£m l∆∞∆°ng theo ph·∫ßn trƒÉm cho m·ªôt ho·∫∑c t·∫•t c·∫£ lo·∫°i nh√¢n vi√™n c√πng l√∫c.
            </div>
          </div>

          <form class="bulk-form" (ngSubmit)="bulkUpdateSalary()">
            <div class="form-section">
              <h3> Ch·ªçn ƒë·ªëi t∆∞·ª£ng √°p d·ª•ng</h3>
              
              <div class="form-group">
                <label class="checkbox-label">
                  <input 
                    type="checkbox" 
                    [(ngModel)]="applyToAllTypes"
                    name="applyToAllTypes"
                    (change)="bulkType = ''">
                  <span>√Åp d·ª•ng cho t·∫•t c·∫£ lo·∫°i nh√¢n vi√™n</span>
                </label>
              </div>

              <div class="form-group" *ngIf="!applyToAllTypes">
                <label class="form-label required">Lo·∫°i nh√¢n vi√™n</label>
                <select 
                  [(ngModel)]="bulkType"
                  name="bulkType"
                  (change)="onBulkTypeSelect(bulkType)"
                  class="form-control"
                  [class.error]="hasValidationError('bulkType')"
                  [required]="!applyToAllTypes">
                  <option value="">-- Ch·ªçn lo·∫°i nh√¢n vi√™n --</option>
                  <option *ngFor="let type of employeeTypes" [value]="type.loaiNhanVien">
                    {{type.loaiNhanVien}} ({{formatCurrencyShort(type.luong)}})
                  </option>
                </select>
                <span class="error-text" *ngIf="hasValidationError('bulkType')">
                  {{getValidationError('bulkType')}}
                </span>
              </div>

              <!-- Advanced Filters -->
              <div class="advanced-filters" *ngIf="applyToAllTypes">
                <div class="filter-header" (click)="showAdvancedFilters = !showAdvancedFilters">
                  <span> B·ªô l·ªçc n√¢ng cao</span>
                  <span class="toggle-icon">{{showAdvancedFilters ? '‚ñº' : '‚ñ∂'}}</span>
                </div>
                <div class="filter-content" *ngIf="showAdvancedFilters">
                  <div class="form-row">
                    <div class="form-group">
                      <label class="form-label">L∆∞∆°ng t·ªëi thi·ªÉu</label>
                      <input 
                        type="number" 
                        [(ngModel)]="minCurrentSalary"
                        name="minCurrentSalary"
                        class="form-control"
                        min="0"
                        step="1000000"
                        placeholder="Kh√¥ng gi·ªõi h·∫°n">
                    </div>
                    <div class="form-group">
                      <label class="form-label">L∆∞∆°ng t·ªëi ƒëa</label>
                      <input 
                        type="number" 
                        [(ngModel)]="maxCurrentSalary"
                        name="maxCurrentSalary"
                        class="form-control"
                        min="0"
                        step="1000000"
                        placeholder="Kh√¥ng gi·ªõi h·∫°n">
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-section">
              <h3> M·ª©c thay ƒë·ªïi</h3>
              
              <div class="form-group">
                <label class="form-label required">Ph·∫ßn trƒÉm tƒÉng/gi·∫£m (%)</label>
                <div class="percentage-input-group">
                  <input 
                    type="number" 
                    [(ngModel)]="percentageIncrease"
                    name="percentageIncrease"
                    class="form-control"
                    [class.error]="hasValidationError('percentageIncrease')"
                    step="0.1"
                    min="-100"
                    max="1000"
                    placeholder="Nh·∫≠p ph·∫ßn trƒÉm..."
                    required>
                  <span class="input-suffix">%</span>
                </div>
                <span class="hint-text">
                  S·ªë √¢m ƒë·ªÉ gi·∫£m l∆∞∆°ng (t·ªëi ƒëa -100%), s·ªë d∆∞∆°ng ƒë·ªÉ tƒÉng l∆∞∆°ng (t·ªëi ƒëa 1000%)
                </span>
                <span class="error-text" *ngIf="hasValidationError('percentageIncrease')">
                  {{getValidationError('percentageIncrease')}}
                </span>
              </div>

              <!-- Quick Percentage Buttons -->
              <div class="quick-percentage-btns">
                <button type="button" class="quick-btn decrease" (click)="percentageIncrease = -10">-10%</button>
                <button type="button" class="quick-btn decrease" (click)="percentageIncrease = -5">-5%</button>
                <button type="button" class="quick-btn increase" (click)="percentageIncrease = 5">+5%</button>
                <button type="button" class="quick-btn increase" (click)="percentageIncrease = 10">+10%</button>
                <button type="button" class="quick-btn increase" (click)="percentageIncrease = 15">+15%</button>
                <button type="button" class="quick-btn increase" (click)="percentageIncrease = 20">+20%</button>
              </div>

              <!-- Bulk Preview -->
              <div class="bulk-preview" *ngIf="(bulkType || applyToAllTypes) && percentageIncrease !== 0">
                <h4> Xem tr∆∞·ªõc k·∫øt qu·∫£</h4>
                
                <div class="preview-table" *ngIf="!applyToAllTypes && bulkType">
                  <div class="preview-item">
                    <span class="type-name">{{bulkType}}</span>
                    <div class="salary-change">
                      <span class="old-salary">
                        {{formatCurrency(getBulkSalary())}}
                      </span>
                      <span class="arrow">‚Üí</span>
                      <span class="new-salary">
                        {{formatCurrency(calculateNewSalary(getBulkSalary(), percentageIncrease))}}
                      </span>
                    </div>
                  </div>
                </div>

                <div class="preview-summary" *ngIf="applyToAllTypes">
                  <div class="summary-item">
                    <span class="label">S·ªë lo·∫°i s·∫Ω c·∫≠p nh·∫≠t:</span>
                    <strong>{{getFilteredTypes().length}}</strong>
                  </div>
                  <div class="summary-item">
                    <span class="label">H√†nh ƒë·ªông:</span>
                    <strong [class.increase]="percentageIncrease > 0" [class.decrease]="percentageIncrease < 0">
                      {{percentageIncrease > 0 ? 'TƒÉng' : 'Gi·∫£m'}} {{Math.abs(percentageIncrease)}}%
                    </strong>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">L√Ω do thay ƒë·ªïi (t√πy ch·ªçn)</label>
                <textarea 
                  [(ngModel)]="bulkReason"
                  name="bulkReason"
                  class="form-control"
                  rows="3"
                  placeholder="Nh·∫≠p l√Ω do thay ƒë·ªïi l∆∞∆°ng h√†ng lo·∫°t..."></textarea>
              </div>
            </div>

            <div class="form-actions">
              <button 
                type="button" 
                class="btn btn-outline"
                (click)="resetBulkForm()"
                [disabled]="submitting">
                 ƒê·∫∑t l·∫°i
              </button>
              <button 
                type="submit" 
                class="btn btn-primary"
                [disabled]="submitting || (!bulkType && !applyToAllTypes) || percentageIncrease === 0">
                <span *ngIf="!submitting">
                   √Åp d·ª•ng thay ƒë·ªïi
                </span>
                <span *ngIf="submitting">
                  <span class="spinner-small"></span> ƒêang x·ª≠ l√Ω...
                </span>
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- HISTORY TAB -->
      <div class="tab-panel" *ngIf="activeTab === 'history'">
        <div class="history-container">
          <div class="history-header">
            <button 
              class="btn btn-danger-outline" 
              (click)="clearHistory()"
              *ngIf="salaryHistory.length > 0">
               X√≥a l·ªãch s·ª≠
            </button>
          </div>

          <div class="history-list" *ngIf="salaryHistory.length > 0">
            <div class="history-item" *ngFor="let change of salaryHistory">
              <div class="history-header-row">
                <div class="change-type">
                  <span class="type-badge">{{change.loaiNhanVien}}</span>
                  <span class="affected-count">{{change.affectedEmployees}} nh√¢n vi√™n</span>
                </div>
                <div class="change-date">{{formatDate(change.timestamp)}}</div>
              </div>
              
              <div class="history-details">
                <div class="salary-comparison">
                  <div class="salary-box old">
                    <span class="label">L∆∞∆°ng c≈©</span>
                    <span class="value">{{formatCurrency(change.oldSalary)}}</span>
                  </div>
                  <div class="arrow-container">
                    <span class="arrow">‚Üí</span>
                  </div>
                  <div class="salary-box new">
                    <span class="label">L∆∞∆°ng m·ªõi</span>
                    <span class="value">{{formatCurrency(change.newSalary)}}</span>
                  </div>
                </div>
                
                <div class="change-stats">
                  <div class="stat">
                    <span class="stat-label">Ch√™nh l·ªách:</span>
                    <span class="stat-value" 
                          [class.positive]="change.percentageChange > 0"
                          [class.negative]="change.percentageChange < 0">
                      {{formatPercentage(change.percentageChange)}}
                    </span>
                  </div>
                  <div class="stat">
                    <span class="stat-label">S·ªë ti·ªÅn:</span>
                    <span class="stat-value"
                          [class.positive]="change.newSalary > change.oldSalary"
                          [class.negative]="change.newSalary < change.oldSalary">
                      {{formatCurrency(change.newSalary - change.oldSalary)}}
                    </span>
                  </div>
                </div>

                <div class="change-reason" *ngIf="change.reason">
                  <strong>L√Ω do:</strong> {{change.reason}}
                </div>
              </div>
            </div>
          </div>

          <div class="empty-state" *ngIf="salaryHistory.length === 0">
            <div class="empty-icon"></div>
            <h3>Ch∆∞a c√≥ l·ªãch s·ª≠ thay ƒë·ªïi</h3>
            <p>C√°c thay ƒë·ªïi l∆∞∆°ng s·∫Ω ƒë∆∞·ª£c ghi l·∫°i t·∫°i ƒë√¢y</p>
          </div>
        </div>
      </div>

      <!-- STATISTICS TAB -->
      <!-- Statistics Tab (Th·ªëng k√™) -->
      <div class="tab-panel" *ngIf="activeTab === 'statistics'">

        <div class="statistics-container">
          <h3 class="stats-title">
            Th·ªëng k√™ chi ti·∫øt v·ªÅ l∆∞∆°ng
          </h3>

          <!-- Loading State -->
          <div class="loading-overlay" *ngIf="loadingSalaryStats">
            <div class="spinner"></div>
            <p>ƒêang t·∫£i th·ªëng k√™ chi ti·∫øt...</p>
          </div>

          <div class="error-state" *ngIf="error && !loadingSalaryStats">
            <div class="error-message">{{error}}</div>
          </div>

          <!-- Statistics Content -->
          <div *ngIf="salaryStatistics && !loadingSalaryStats && !error">
            <!-- Overview Cards -->
            <div class="stats-overview-grid">
              <div class="stat-card featured-card">
                <div class="stat-details">
                  <div class="stat-label">T·ªïng qu·ªπ l∆∞∆°ng</div>
                  <div class="stat-value large">{{formatCurrency(salaryStatistics.totalSalaryExpense)}}</div>
                  <div class="stat-sublabel">{{salaryStatistics.totalEmployees}} nh√¢n vi√™n</div>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-details">
                  <div class="stat-label">L∆∞∆°ng trung b√¨nh</div>
                  <div class="stat-value">{{formatCurrency(salaryStatistics.averageSalary)}}</div>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-details">
                  <div class="stat-label">L∆∞∆°ng trung v·ªã</div>
                  <div class="stat-value">{{formatCurrency(salaryStatistics.medianSalary)}}</div>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-details">
                  <div class="stat-label">L∆∞∆°ng th·∫•p nh·∫•t</div>
                  <div class="stat-value">{{formatCurrency(salaryStatistics.minSalary)}}</div>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-details">
                  <div class="stat-label">L∆∞∆°ng cao nh·∫•t</div>
                  <div class="stat-value">{{formatCurrency(salaryStatistics.maxSalary)}}</div>
                </div>
              </div>
            </div>

            <!-- Section Divider -->
            <div class="stats-section-divider"></div>

            <!-- By Employee Type -->
            <div class="section stats-section">
              <h4 class="stats-section-title">Ph√¢n t√≠ch theo lo·∫°i nh√¢n vi√™n</h4>
              <div class="table-responsive">
                <table class="stats-table">
                  <thead>
                    <tr>
                      <th>Lo·∫°i nh√¢n vi√™n</th>
                      <th class="text-center">S·ªë l∆∞·ª£ng</th>
                      <th class="text-right">L∆∞∆°ng TB</th>
                      <th class="text-right">T·ªïng chi</th>
                      <th class="text-center">% Qu·ªπ l∆∞∆°ng</th>
                      <th class="text-center">So s√°nh ng√†nh</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let type of salaryStatistics.byEmployeeType">
                      <td><strong>{{type.loaiNhanVien}}</strong></td>
                      <td class="text-center">{{type.count}}</td>
                      <td class="text-right">{{formatCurrency(type.averageSalary)}}</td>
                      <td class="text-right">{{formatCurrency(type.totalSalary)}}</td>
                      <td class="text-center">
                        <div class="percentage-bar">
                          <div class="bar-fill" [style.width.%]="type.percentageOfTotal"></div>
                          <span class="bar-label">{{type.percentageOfTotal.toFixed(1)}}%</span>
                        </div>
                      </td>
                      <td class="text-center">
                        <span *ngIf="salaryComparisons.get(type.loaiNhanVien) as comparison"
                              [class]="'comparison-badge ' + comparison.comparison">
                          <span *ngIf="comparison.comparison === 'above'">‚Üë {{comparison.percentageDifference.toFixed(1)}}%</span>
                          <span *ngIf="comparison.comparison === 'below'">‚Üì {{comparison.percentageDifference.toFixed(1)}}%</span>
                          <span *ngIf="comparison.comparison === 'equal'">‚âà B·∫±ng TB</span>
                        </span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="stats-section-divider"></div>

            <!-- Salary Distribution -->
            <div class="section stats-section">
              <h4 class="stats-section-title">Ph√¢n b·ªï l∆∞∆°ng</h4>
              <div class="distribution-chart">
                <div class="distribution-bar" *ngFor="let dist of salaryStatistics.salaryDistribution">
                  <div class="bar-label">{{dist.range}}</div>
                  <div class="bar-container">
                    <div class="bar" [style.width.%]="dist.percentage">
                      <span class="bar-value">{{dist.count}} NV ({{dist.percentage.toFixed(1)}}%)</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="stats-section-divider"></div>

            <!-- By Branch -->
            <div class="section stats-section">
              <h4 class="stats-section-title">Ph√¢n t√≠ch theo chi nh√°nh</h4>
              <div class="branch-grid">
                <div class="branch-card" *ngFor="let branch of salaryStatistics.byBranch">
                  <div class="branch-header">
                    <h5>{{branch.tenChiNhanh}}</h5>
                    <span class="branch-code">{{branch.maChiNhanh}}</span>
                  </div>
                  <div class="branch-stats">
                    <div class="stat-item">
                      <span class="label">Nh√¢n vi√™n:</span>
                      <span class="value">{{branch.totalEmployees}}</span>
                    </div>
                    <div class="stat-item">
                      <span class="label">L∆∞∆°ng TB:</span>
                      <span class="value">{{formatCurrency(branch.averageSalary)}}</span>
                    </div>
                    <div class="stat-item">
                      <span class="label">T·ªïng chi:</span>
                      <span class="value">{{formatCurrency(branch.totalSalary)}}</span>
                    </div>
                  </div>
                  <div class="branch-types">
                    <div class="type-item" *ngFor="let typeData of branch.byType">
                      <span class="type-name">{{typeData.loaiNhanVien}}:</span>
                      <span class="type-count">{{typeData.count}}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="stats-section-divider"></div>

            <!-- By Department (Doctors) -->
            <div class="section stats-section" *ngIf="salaryStatistics.byDepartment.length > 0">
              <h4 class="stats-section-title">Ph√¢n t√≠ch theo khoa (B√°c sƒ©)</h4>
              <div class="table-responsive">
                <table class="stats-table">
                  <thead>
                    <tr>
                      <th>Khoa</th>
                      <th class="text-center">S·ªë b√°c sƒ©</th>
                      <th class="text-right">L∆∞∆°ng trung b√¨nh</th>
                      <th class="text-right">T·ªïng chi ph√≠</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let dept of salaryStatistics.byDepartment">
                      <td><strong>{{dept.tenKhoa}}</strong></td>
                      <td class="text-center">{{dept.doctorCount}}</td>
                      <td class="text-right">{{formatCurrency(dept.averageSalary)}}</td>
                      <td class="text-right">{{formatCurrency(dept.totalSalary)}}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="stats-section-divider"></div>

            <!-- Salary Trends -->
            <div class="section stats-section" *ngIf="salaryStatistics.salaryTrends.length > 0">
              <h4 class="stats-section-title">Xu h∆∞·ªõng l∆∞∆°ng (12 th√°ng g·∫ßn ƒë√¢y)</h4>
              <div class="line-chart-container">
                <svg class="line-chart" viewBox="0 0 1200 300" preserveAspectRatio="xMidYMid meet">
                  <!-- Grid lines -->
                  <defs>
                    <linearGradient id="lineGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                      <stop offset="0%" style="stop-color:#667eea;stop-opacity:0.3" />
                      <stop offset="100%" style="stop-color:#667eea;stop-opacity:0" />
                    </linearGradient>
                  </defs>
                  
                  <!-- Y-axis grid lines -->
                  <line x1="80" y1="30" x2="80" y2="250" stroke="#ddd" stroke-width="2" />
                  <!-- X-axis -->
                  <line x1="80" y1="250" x2="1180" y2="250" stroke="#ddd" stroke-width="2" />
                  
                  <!-- Data line and area -->
                  <polyline 
                    class="chart-line"
                    [attr.points]="getTrendLinePoints(salaryStatistics.salaryTrends)"
                    fill="none"
                    stroke="#667eea"
                    stroke-width="3"
                    stroke-linejoin="round"
                    stroke-linecap="round" />
                  
                  <!-- Data area (fill under curve) -->
                  <polygon
                    class="chart-area"
                    [attr.points]="getTrendAreaPoints(salaryStatistics.salaryTrends)"
                    fill="url(#lineGradient)" />
                  
                  <!-- Data points (circles) -->
                  <circle *ngFor="let trend of salaryStatistics.salaryTrends; let i = index"
                          [attr.cx]="80 + (i * 91.67)"
                          [attr.cy]="250 - ((trend.totalSalary / getMaxTrendSalary(salaryStatistics.salaryTrends)) * 200)"
                          r="5"
                          fill="#667eea"
                          stroke="white"
                          stroke-width="2"
                          class="data-point">
                    <title>{{trend.month}}: {{formatCurrency(trend.totalSalary)}} - {{trend.employeeCount}} NV</title>
                  </circle>
                  
                  <!-- X-axis labels -->
                  <text *ngFor="let trend of salaryStatistics.salaryTrends; let i = index"
                        [attr.x]="80 + (i * 91.67)"
                        y="275"
                        text-anchor="middle"
                        font-size="12"
                        fill="#666"
                        class="axis-label">
                    {{trend.month.split(',')[0]}}
                  </text>
                </svg>
                
                <!-- Legend -->
                <div class="chart-legend">
                  <div class="legend-item">
                    <span class="legend-color" style="background: #667eea;"></span>
                    <span>Qu·ªπ l∆∞∆°ng theo th√°ng</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="stats-section-divider"></div>

            <!-- Forecast -->
            <div class="section stats-section" *ngIf="salaryForecast.length > 0">
              <h4 class="stats-section-title">D·ª± b√°o qu·ªπ l∆∞∆°ng (6 th√°ng t·ªõi)</h4>
              <div class="forecast-grid">
                <div class="forecast-card" *ngFor="let forecast of salaryForecast">
                  <div class="forecast-month">{{forecast.month}}</div>
                  <div class="forecast-value">{{formatCurrencyShort(forecast.predictedTotalSalary)}}</div>
                  <div class="forecast-details">
                    <span>~{{forecast.predictedEmployeeCount}} NV</span>
                    <span class="confidence" [class.high]="forecast.confidence > 0.8"
                                            [class.medium]="forecast.confidence > 0.6 && forecast.confidence <= 0.8"
                                            [class.low]="forecast.confidence <= 0.6">
                      ƒê·ªô tin c·∫≠y: {{(forecast.confidence * 100).toFixed(0)}}%
                    </span>
                  </div>
                </div>
              </div>
            </div>
            <div class="stats-section-divider"></div>

            <!-- Top Earners -->
            <div class="section stats-section" *ngIf="salaryStatistics.topEarners.length > 0">
              <h4 class="stats-section-title">üèÜ Top nh√¢n vi√™n c√≥ l∆∞∆°ng cao nh·∫•t</h4>
              <div class="top-earners-list">
                <div class="earner-card" *ngFor="let earner of salaryStatistics.topEarners; let i = index">
                  <div class="rank">#{{i + 1}}</div>
                  <div class="earner-info">
                    <div class="earner-name">{{earner.hoTen}}</div>
                    <div class="earner-details">
                      <span class="badge">{{earner.loaiNhanVien}}</span>
                      <span>{{earner.branch}}</span>
                      <span *ngIf="earner.department">{{earner.department}}</span>
                    </div>
                  </div>
                  <div class="earner-salary">{{formatCurrency(earner.salary)}}</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Empty State -->
          <div class="empty-state" *ngIf="!salaryStatistics && !loadingSalaryStats">
            <p>Kh√¥ng c√≥ d·ªØ li·ªáu th·ªëng k√™</p>
            <button class="btn btn-primary" (click)="loadDetailedSalaryStatistics()">
              T·∫£i th·ªëng k√™
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
