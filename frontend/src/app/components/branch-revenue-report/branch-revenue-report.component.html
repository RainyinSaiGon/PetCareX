<div class="revenue-report-container">
  <div class="header-section">
    <h1>üìä B√°o C√°o Doanh Thu Chi Nh√°nh</h1>
    <p class="subtitle">Ph√¢n t√≠ch doanh thu theo chi nh√°nh v√† th·ªùi gian</p>
  </div>

  <div class="controls-section">
    <div class="filter-group">
      <label>L·ªçc theo Chi Nh√°nh:</label>
      <select [(ngModel)]="selectedBranch" (change)="onFilterChange()" class="filter-select">
        <option value="">-- T·∫•t c·∫£ chi nh√°nh --</option>
        <option value="CN01">Chi nh√°nh H√† N·ªôi</option>
        <option value="CN02">Chi nh√°nh TP HCM</option>
        <option value="CN03">Chi nh√°nh ƒê√† N·∫µng</option>
      </select>
    </div>

    <div class="filter-group">
      <label>NƒÉm:</label>
      <input type="number" [(ngModel)]="selectedYear" (change)="onFilterChange()" min="2020" max="2099" />
    </div>
  </div>

  <!-- System Revenue Summary -->
  <div class="summary-section" *ngIf="systemRevenue && !loading">
    <div class="summary-card">
      <div class="summary-icon">üí∞</div>
      <div class="summary-content">
        <p class="summary-label">T·ªïng Doanh Thu H·ªá Th·ªëng</p>
        <p class="summary-value">{{ formatCurrency(systemRevenue.totalRevenue) }}</p>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-icon">üìà</div>
      <div class="summary-content">
        <p class="summary-label">T·ªïng Giao D·ªãch</p>
        <p class="summary-value">{{ systemRevenue.totalTransactions }}</p>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-icon">üî¢</div>
      <div class="summary-content">
        <p class="summary-label">Gi√° Tr·ªã Trung B√¨nh</p>
        <p class="summary-value">{{ formatCurrency(systemRevenue.averageTransactionValue) }}</p>
      </div>
    </div>
  </div>

  <!-- Branch Revenue Table -->
  <div class="revenue-table-section">
    <h2>Doanh Thu Chi Nh√°nh</h2>
    <div class="table-wrapper" *ngIf="!loading">
      <table class="revenue-table" *ngIf="revenueReports.length > 0">
        <thead>
          <tr>
            <th>M√£ Chi Nh√°nh</th>
            <th>T√™n Chi Nh√°nh</th>
            <th>T·ªïng Doanh Thu</th>
            <th>S·ªë Giao D·ªãch</th>
            <th>Gi√° Tr·ªã TB</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let report of revenueReports" class="data-row">
            <td>
              <span class="badge">{{ report.MaChiNhanh }}</span>
            </td>
            <td class="branch-name">{{ report.TenChiNhanh }}</td>
            <td class="revenue-value">{{ formatCurrency(report.TotalRevenue) }}</td>
            <td class="transaction-count">{{ report.TransactionCount }}</td>
            <td>{{ formatCurrency(report.AverageTransactionValue) }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Top Products -->
  <div class="top-products-section">
    <h2>Top S·∫£n Ph·∫©m B√°n Ch·∫°y</h2>
    <div class="products-grid">
      <div class="product-card" *ngFor="let product of topProducts.slice(0, 6)">
        <div class="product-rank">ü•á</div>
        <p class="product-name">{{ product.TenSanPham }}</p>
        <p class="product-revenue">{{ formatCurrency(product.TotalRevenue) }}</p>
        <p class="product-units">{{ product.UnitsSold }} b·ªô</p>
      </div>
    </div>
  </div>

  <!-- Monthly Revenue Chart -->
  <div class="chart-section">
    <h2>Doanh Thu Theo Th√°ng</h2>
    <div class="chart-container">
      <div class="chart-bars">
        <div class="bar-wrapper" *ngFor="let month of monthlyChartData">
          <div 
            class="bar" 
            [style.height.%]="(month.totalRevenue / (monthlyChartData | map: 'totalRevenue' | max)) * 100"
            [title]="formatCurrency(month.totalRevenue)"
          ></div>
          <span class="bar-label">{{ getMonthName(month.month) }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination-section" *ngIf="revenueReports.length > 0">
    <button
      [disabled]="currentPage === 1"
      (click)="onPageChange(1)"
      class="pagination-btn"
    >
      ‚èÆÔ∏è
    </button>
    <button
      [disabled]="currentPage === 1"
      (click)="onPageChange(currentPage - 1)"
      class="pagination-btn"
    >
      ‚óÄÔ∏è
    </button>
    <span class="page-indicator">{{ currentPage }} / {{ totalPages }}</span>
    <button
      [disabled]="currentPage === totalPages"
      (click)="onPageChange(currentPage + 1)"
      class="pagination-btn"
    >
      ‚ñ∂Ô∏è
    </button>
    <button
      [disabled]="currentPage === totalPages"
      (click)="onPageChange(totalPages)"
      class="pagination-btn"
    >
      ‚è≠Ô∏è
    </button>
  </div>
</div>
