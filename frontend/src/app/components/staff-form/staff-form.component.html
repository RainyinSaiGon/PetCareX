<div class="staff-form-container">
  <div class="form-header">
    <h2>
      <span *ngIf="!isEditMode">‚ûï Th√™m Nh√¢n Vi√™n M·ªõi</span>
      <span *ngIf="isEditMode">‚úèÔ∏è Ch·ªânh S·ª≠a Nh√¢n Vi√™n</span>
    </h2>
    <button class="btn-back" routerLink="/admin/staff">
      ‚Üê Quay l·∫°i
    </button>
  </div>

  <!-- Loading -->
  <div class="loading" *ngIf="loading">
    <div class="spinner"></div>
    <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
  </div>

  <!-- Error Message -->
  <div class="error-message" *ngIf="error">
    ‚ö†Ô∏è {{error}}
  </div>

  <!-- Form -->
  <form (ngSubmit)="onSubmit()" *ngIf="!loading" class="employee-form">
    <div class="form-sections">
      <!-- Personal Information -->
      <div class="form-section">
        <h3 class="section-title">Th√¥ng tin c√° nh√¢n</h3>
        
        <div class="form-row">
          <div class="form-group" *ngIf="!isEditMode">
            <label for="maNhanVien" class="required">M√£ nh√¢n vi√™n</label>
            <input
              type="text"
              id="maNhanVien"
              [(ngModel)]="formData.maNhanVien"
              name="maNhanVien"
              class="form-control"
              [class.error]="errors.maNhanVien"
              maxlength="5"
              placeholder="Nh·∫≠p 5 k√Ω t·ª±"
              required>
            <span class="error-text" *ngIf="errors.maNhanVien">{{errors.maNhanVien}}</span>
          </div>

          <div class="form-group" *ngIf="isEditMode">
            <label>M√£ nh√¢n vi√™n</label>
            <input
              type="text"
              [(ngModel)]="formData.maNhanVien"
              name="maNhanVien"
              class="form-control"
              readonly
              disabled>
          </div>

          <div class="form-group">
            <label for="hoTen" class="required">H·ªç v√† t√™n</label>
            <input
              type="text"
              id="hoTen"
              [(ngModel)]="formData.hoTen"
              name="hoTen"
              class="form-control"
              [class.error]="errors.hoTen"
              placeholder="Nguy·ªÖn VƒÉn A"
              required>
            <span class="error-text" *ngIf="errors.hoTen">{{errors.hoTen}}</span>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="sdt" class="required">S·ªë ƒëi·ªán tho·∫°i</label>
            <input
              type="tel"
              id="sdt"
              [(ngModel)]="formData.sdt"
              name="sdt"
              class="form-control"
              [class.error]="errors.sdt"
              maxlength="10"
              placeholder="0123456789"
              required>
            <span class="error-text" *ngIf="errors.sdt">{{errors.sdt}}</span>
          </div>

          <div class="form-group">
            <label for="ngaySinh">Ng√†y sinh</label>
            <input
              type="date"
              id="ngaySinh"
              [(ngModel)]="formData.ngaySinh"
              name="ngaySinh"
              class="form-control"
              [class.error]="errors.ngaySinh">
            <span class="error-text" *ngIf="errors.ngaySinh">{{errors.ngaySinh}}</span>
            <span class="hint-text" *ngIf="formData.ngaySinh && !errors.ngaySinh">
              Tu·ªïi: {{calculateAge(formData.ngaySinh)}}
            </span>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="ngayVaoLam">Ng√†y v√†o l√†m</label>
            <input
              type="date"
              id="ngayVaoLam"
              [(ngModel)]="formData.ngayVaoLam"
              name="ngayVaoLam"
              class="form-control"
              [class.error]="errors.ngayVaoLam">
            <span class="hint-text">ƒê·ªÉ tr·ªëng s·∫Ω l·∫•y ng√†y hi·ªán t·∫°i</span>
          </div>
        </div>
      </div>

      <!-- Work Information -->
      <div class="form-section">
        <h3 class="section-title">Th√¥ng tin c√¥ng vi·ªác</h3>

        <div class="form-row">
          <div class="form-group">
            <label for="maChiNhanh" class="required">Chi nh√°nh</label>
            <select
              id="maChiNhanh"
              [(ngModel)]="formData.maChiNhanh"
              name="maChiNhanh"
              class="form-control"
              [class.error]="errors.maChiNhanh"
              required>
              <option value="">-- Ch·ªçn chi nh√°nh --</option>
              <option *ngFor="let branch of branches" [value]="branch.maChiNhanh">
                {{branch.tenChiNhanh}} ({{branch.diaChi}})
              </option>
            </select>
            <span class="error-text" *ngIf="errors.maChiNhanh">{{errors.maChiNhanh}}</span>
          </div>

          <div class="form-group">
            <label for="loaiNhanVien" class="required">Lo·∫°i nh√¢n vi√™n</label>
            <select
              id="loaiNhanVien"
              [(ngModel)]="formData.loaiNhanVien"
              name="loaiNhanVien"
              class="form-control"
              [class.error]="errors.loaiNhanVien"
              required>
              <option value="">-- Ch·ªçn lo·∫°i nh√¢n vi√™n --</option>
              <option *ngFor="let type of employeeTypes" [value]="type.loaiNhanVien">
                {{type.loaiNhanVien}} ({{formatCurrency(type.luong)}})
              </option>
            </select>
            <span class="error-text" *ngIf="errors.loaiNhanVien">{{errors.loaiNhanVien}}</span>
            <div class="salary-info" *ngIf="formData.loaiNhanVien">
              <strong>L∆∞∆°ng:</strong> {{formatCurrency(getEmployeeTypeSalary())}}
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="maKhoa">Khoa (t√πy ch·ªçn)</label>
            <select
              id="maKhoa"
              [(ngModel)]="formData.maKhoa"
              name="maKhoa"
              class="form-control">
              <option value="">-- Kh√¥ng thu·ªôc khoa n√†o --</option>
              <option *ngFor="let dept of departments" [value]="dept.maKhoa">
                {{dept.tenKhoa}}
              </option>
            </select>
            <span class="hint-text">Ch·ªâ √°p d·ª•ng cho b√°c sƒ©</span>
          </div>
        </div>
      </div>

      <!-- Employee Statistics (Edit Mode Only) -->
      <div class="form-section info-section" *ngIf="isEditMode && employee?.statistics">
        <h3 class="section-title">Th·ªëng k√™</h3>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">T·ªïng l·ªãch h·∫πn</div>
            <div class="stat-value">{{employee?.statistics?.totalAppointments || 0}}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">ƒê√£ ho√†n th√†nh</div>
            <div class="stat-value success">{{employee?.statistics?.completedAppointments || 0}}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">ƒêang ch·ªù</div>
            <div class="stat-value warning">{{employee?.statistics?.pendingAppointments || 0}}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">NƒÉm c√¥ng t√°c</div>
            <div class="stat-value">{{employee?.statistics?.yearsOfService || 0}}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <button
        type="button"
        class="btn btn-secondary"
        (click)="onCancel()"
        [disabled]="submitting">
        H·ªßy
      </button>
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="submitting">
        <span *ngIf="!submitting">
          <span *ngIf="!isEditMode">‚ûï Th√™m nh√¢n vi√™n</span>
          <span *ngIf="isEditMode">üíæ L∆∞u thay ƒë·ªïi</span>
        </span>
        <span *ngIf="submitting">
          <span class="spinner-small"></span> ƒêang x·ª≠ l√Ω...
        </span>
      </button>
    </div>
  </form>
</div>
