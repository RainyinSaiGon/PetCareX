<div class="container">
  <div class="breadcrumb">
    <span class="link" (click)="router.navigate(['/customers'])">
      <i class="fas fa-users"></i> Kh√°ch H√†ng
    </span>
    <span class="separator">/</span>
    <span class="link" (click)="router.navigate(['/customers', customerId, 'pets'])">
      <i class="fas fa-paw"></i> {{ customerName || 'Th√∫ C∆∞ng' }}
    </span>
    <span class="separator">/</span>
    <span>{{ isEditMode ? 'Ch·ªânh S·ª≠a' : 'Th√™m M·ªõi' }}</span>
  </div>

  <div class="header">
    <div class="header-content">
      <div>
        <h1>{{ isEditMode ? 'Ch·ªânh S·ª≠a Th√∫ C∆∞ng' : 'Th√™m Th√∫ C∆∞ng M·ªõi' }}</h1>
        <p class="subtitle">C·∫≠p nh·∫≠t th√¥ng tin chi ti·∫øt cho th√∫ c∆∞ng c·ªßa b·∫°n</p>
      </div>
    </div>
  </div>

  <div *ngIf="error" class="alert alert-error">
    <i class="fas fa-exclamation-circle"></i> {{ error }}
  </div>

  <div *ngIf="success" class="alert alert-success">
    <i class="fas fa-check-circle"></i> {{ success }}
  </div>

  <!-- Skeleton Loading -->
  <div *ngIf="loading && isEditMode" class="pet-form skeleton-form">
    <div class="form-section">
      <div class="section-title">
        <div class="skeleton skeleton-title"></div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <div class="skeleton skeleton-label"></div>
          <div class="skeleton skeleton-input"></div>
        </div>
      </div>
    </div>

    <div class="form-section">
      <div class="section-title">
        <div class="skeleton skeleton-title"></div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <div class="skeleton skeleton-label"></div>
          <div class="skeleton skeleton-input"></div>
        </div>
        <div class="form-group">
          <div class="skeleton skeleton-label"></div>
          <div class="skeleton skeleton-input"></div>
        </div>
      </div>
    </div>

    <div class="form-section">
      <div class="section-title">
        <div class="skeleton skeleton-title"></div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <div class="skeleton skeleton-label"></div>
          <div class="skeleton skeleton-input"></div>
        </div>
        <div class="form-group">
          <div class="skeleton skeleton-label"></div>
          <div class="skeleton skeleton-input"></div>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <div class="skeleton skeleton-button"></div>
      <div class="skeleton skeleton-button"></div>
    </div>
  </div>

  <form [formGroup]="petForm" (ngSubmit)="onSubmit()" class="pet-form" *ngIf="!loading || !isEditMode">
    <!-- Customer Selection -->
    <div class="form-section">
      <div class="section-title">
        <i class="fas fa-user-circle"></i> Ch·ªß S·ªü H·ªØu
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="MaKhachHang" class="required">Ch·ªçn Kh√°ch H√†ng</label>
          <div class="input-wrapper">
            <select
              id="MaKhachHang"
              formControlName="MaKhachHang"
              [class.invalid]="isFieldInvalid('MaKhachHang')"
            >
              <option value="">-- Ch·ªçn kh√°ch h√†ng --</option>
              <option *ngFor="let customer of customers" [value]="customer.MaKhachHang">
                üë§ {{ customer.HoTen }} ({{ customer.SoDienThoai }})
              </option>
            </select>
            <i class="fas fa-chevron-down"></i>
          </div>
          <span class="error-message" *ngIf="isFieldInvalid('MaKhachHang')">
            {{ getErrorMessage('MaKhachHang') }}
          </span>
        </div>
      </div>
    </div>

    <!-- Basic Pet Information -->
    <div class="form-section">
      <div class="section-title">
        <i class="fas fa-info-circle"></i> Th√¥ng Tin C∆° B·∫£n
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="TenThuCung" class="required">T√™n Th√∫ C∆∞ng</label>
          <div class="input-wrapper">
            <input
              type="text"
              id="TenThuCung"
              formControlName="TenThuCung"
              [class.invalid]="isFieldInvalid('TenThuCung')"
              placeholder="Vd: B√¥ng, Miu Miu..."
            />
            <i class="fas fa-paw"></i>
          </div>
          <span class="error-message" *ngIf="isFieldInvalid('TenThuCung')">
            {{ getErrorMessage('TenThuCung') }}
          </span>
        </div>

        <div class="form-group">
          <label for="NgaySinhThuCung">Ng√†y Sinh</label>
          <div class="input-wrapper">
            <input
              type="date"
              id="NgaySinhThuCung"
              formControlName="NgaySinhThuCung"
              [class.invalid]="isFieldInvalid('NgaySinhThuCung')"
              placeholder="mm/dd/yyyy"
            />
            <i class="fas fa-calendar calendar-icon" (click)="focusDateInput('NgaySinhThuCung')" title="Ch·ªçn ng√†y"></i>
          </div>
          <span class="error-message" *ngIf="isFieldInvalid('NgaySinhThuCung')">
            {{ getErrorMessage('NgaySinhThuCung') }}
          </span>
        </div>
      </div>
    </div>

    <!-- Pet Classification -->
    <div class="form-section">
      <div class="section-title">
        <i class="fas fa-cubes"></i> Ph√¢n Lo·∫°i Th√∫ C∆∞ng
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="MaLoaiThuCung" class="required">Lo·∫°i Th√∫ C∆∞ng</label>
          <div class="input-wrapper">
            <select
              id="MaLoaiThuCung"
              formControlName="MaLoaiThuCung"
              [class.invalid]="isFieldInvalid('MaLoaiThuCung')"
            >
              <option value="">-- Ch·ªçn lo·∫°i th√∫ c∆∞ng --</option>
              <option *ngFor="let petType of petTypes" [value]="petType.MaLoaiThuCung">
                {{ getPetTypeEmoji(petType.TenLoaiThuCung) }} {{ petType.TenLoaiThuCung }}
              </option>
            </select>
            <i class="fas fa-chevron-down"></i>
          </div>
          <span class="error-message" *ngIf="isFieldInvalid('MaLoaiThuCung')">
            {{ getErrorMessage('MaLoaiThuCung') }}
          </span>
        </div>

        <div class="form-group">
          <label for="MaChungLoai" class="required">Ch·ªßng Lo·∫°i</label>
          <div class="input-wrapper">
            <select
              id="MaChungLoai"
              formControlName="MaChungLoai"
              [class.invalid]="isFieldInvalid('MaChungLoai')"
            >
              <option value="">-- Ch·ªçn ch·ªßng lo·∫°i --</option>
              <option *ngFor="let breed of filteredBreeds" [value]="breed.MaChungLoaiThuCung">
                {{ breed.TenChungLoaiThuCung }}
              </option>
            </select>
            <i class="fas fa-chevron-down"></i>
          </div>
          <span class="error-message" *ngIf="isFieldInvalid('MaChungLoai')">
            {{ getErrorMessage('MaChungLoai') }}
          </span>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="onCancel()" [disabled]="loading">
        <i class="fas fa-times"></i> H·ªßy
      </button>
      <button type="submit" class="btn btn-primary" [disabled]="loading">
        <i class="fas fa-save"></i> {{ loading ? 'ƒêang x·ª≠ l√Ω...' : (isEditMode ? 'C·∫≠p Nh·∫≠t' : 'Th√™m M·ªõi') }}
      </button>
    </div>
  </form>
</div>
