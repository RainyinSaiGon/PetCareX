<div class="service-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title"><i class="fas fa-hospital"></i> Quản Lý Dịch Vụ Chi Nhánh</h1>
      <p class="page-subtitle">Quản lý các dịch vụ y tế được cung cấp tại các chi nhánh</p>
    </div>
    <button class="btn btn-primary btn-lg" (click)="openCreateForm()">
      <i class="fas fa-plus-circle"></i> Thêm Dịch Vụ Mới
    </button>
  </div>

  <!-- Alerts -->
  <div *ngIf="successMessage" class="alert alert-success alert-dismissible">
    <i class="fas fa-check-circle"></i>
    {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible">
    <i class="fas fa-exclamation-circle"></i>
    {{ errorMessage }}
  </div>

  <!-- Modal Form -->
  <div *ngIf="showForm" class="modal-overlay" (click)="closeForm()">
    <div class="modal-dialog" (click)="$event.stopPropagation()">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">
            <i [class]="isEditMode ? 'fas fa-edit' : 'fas fa-plus'"></i>
            {{ isEditMode ? 'Chỉnh Sửa Dịch Vụ' : 'Tạo Dịch Vụ Mới' }}
          </h2>
          <button class="close-btn" (click)="closeForm()">&times;</button>
        </div>
        
        <div class="modal-body">
          <form [formGroup]="form" (ngSubmit)="submitForm()" class="service-form">
            <!-- Branch Selection -->
            <div class="form-section">
              <h3 class="section-title">Thông Tin Chi Nhánh</h3>
              <div class="form-group">
                <label class="form-label">
                  <span>Chi Nhánh</span>
                  <span class="required">*</span>
                </label>
                <select formControlName="branchId" class="form-control" [disabled]="isEditMode">
                  <option value="">-- Chọn Chi Nhánh --</option>
                  <option *ngFor="let b of branches" [value]="b.id">{{ b.name }}</option>
                </select>
                <small class="form-hint">Chọn chi nhánh cung cấp dịch vụ này</small>
              </div>
            </div>

            <!-- Service Details -->
            <div class="form-section">
              <h3 class="section-title">Thông Tin Dịch Vụ</h3>
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">
                    <span>Loại Dịch Vụ</span>
                    <span class="required">*</span>
                  </label>
                  <select formControlName="serviceId" class="form-control" [disabled]="isEditMode">
                    <option value="">-- Chọn Dịch Vụ --</option>
                    <option *ngFor="let s of services" [value]="s.id">{{ s.name }}</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">
                    <span>Giá Dịch Vụ (VND)</span>
                    <span class="required">*</span>
                  </label>
                  <input type="number" formControlName="price" class="form-control" placeholder="0" />
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">
                  <span>Mô Tả Chi Tiết</span>
                </label>
                <textarea formControlName="description" class="form-control" rows="4" placeholder="Nhập mô tả dịch vụ..."></textarea>
                <small class="form-hint">Mô tả những đặc điểm, lợi ích của dịch vụ này</small>
              </div>
            </div>

            <!-- Status -->
            <div class="form-section">
              <h3 class="section-title">Trạng Thái</h3>
              <div class="form-group">
                <div class="status-toggle">
                  <label class="radio-label">
                    <input type="radio" formControlName="status" value="active" />
                    <span class="radio-custom active"></span>
                    <span>Hoạt Động</span>
                  </label>
                  <label class="radio-label">
                    <input type="radio" formControlName="status" value="inactive" />
                    <span class="radio-custom"></span>
                    <span>Không Hoạt Động</span>
                  </label>
                </div>
              </div>
            </div>
          </form>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeForm()">Hủy</button>
          <button type="button" class="btn btn-primary" (click)="submitForm()" [disabled]="!form.valid || submitting">
            <i [class]="submitting ? 'fas fa-spinner fa-spin' : 'fas fa-save'"></i>
            {{ submitting ? 'Đang lưu...' : 'Lưu' }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Filter & Search Section -->
  <div class="filter-section">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input type="text" [(ngModel)]="searchTerm" placeholder="Tìm kiếm dịch vụ, chi nhánh..." class="search-input" />
    </div>

    <div class="filter-group">
      <div class="filter-item">
        <label>Chi Nhánh</label>
        <select [(ngModel)]="filterBranch" class="form-control">
          <option value="">Tất Cả</option>
          <option *ngFor="let b of branches" [value]="b.id">{{ b.name }}</option>
        </select>
      </div>
      <div class="filter-item">
        <label>Loại Dịch Vụ</label>
        <select [(ngModel)]="filterService" class="form-control">
          <option value="">Tất Cả</option>
          <option *ngFor="let s of services" [value]="s.id">{{ s.name }}</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Đang tải dữ liệu...</p>
  </div>

  <!-- Data Table -->
  <div *ngIf="!loading && getFilteredOfferings().length > 0" class="table-section">
    <div class="table-header">
      <h3>Danh Sách Dịch Vụ ({{ getFilteredOfferings().length }} kết quả)</h3>
      <span class="result-count">Tổng: {{ totalItems }} dịch vụ</span>
    </div>

    <div class="table-responsive">
      <table class="service-table">
        <thead>
          <tr>
            <th class="col-branch">
              <i class="fas fa-building"></i> Chi Nhánh
            </th>
            <th class="col-service">
              <i class="fas fa-stethoscope"></i> Dịch Vụ
            </th>
            <th class="col-price">
              <i class="fas fa-money-bill-wave"></i> Giá
            </th>
            <th class="col-description">
              <i class="fas fa-file-alt"></i> Mô Tả
            </th>
            <th class="col-status">
              <i class="fas fa-circle-notch"></i> Trạng Thái
            </th>
            <th class="col-actions">
              <i class="fas fa-cog"></i> Hành Động
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let o of getFilteredOfferings()" class="table-row">
            <td class="col-branch">
              <span class="badge badge-branch">{{ o.branchName }}</span>
            </td>
            <td class="col-service">
              <strong>{{ o.serviceName }}</strong>
            </td>
            <td class="col-price">
              <span class="price-tag">{{ formatCurrency(o.price) }}</span>
            </td>
            <td class="col-description">
              <span class="description-text" [title]="o.description">
                {{ o.description || 'Không có mô tả' }}
              </span>
            </td>
            <td class="col-status">
              <span [class]="'status-badge status-' + o.status">
                {{ o.status === 'active' ? '✓ Hoạt Động' : '✗ Không Hoạt Động' }}
              </span>
            </td>
            <td class="col-actions">
              <button class="btn-action btn-edit" (click)="openEditForm(o)" title="Chỉnh sửa">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn-action btn-delete" (click)="deleteOffering(o)" title="Xóa">
                <i class="fas fa-trash-alt"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div *ngIf="totalPages > 1" class="pagination-section">
      <button class="btn-page" [disabled]="currentPage === 1" (click)="onPageChange(currentPage - 1)">
        <i class="fas fa-chevron-left"></i> Trước
      </button>
      <span class="page-info">Trang {{ currentPage }} / {{ totalPages }}</span>
      <button class="btn-page" [disabled]="currentPage === totalPages" (click)="onPageChange(currentPage + 1)">
        Sau <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && getFilteredOfferings().length === 0" class="empty-state">
    <div class="empty-icon">
      <i class="fas fa-inbox"></i>
    </div>
    <h3>Không Có Dịch Vụ Nào</h3>
    <p>{{ searchTerm || filterBranch || filterService ? 'Không tìm thấy dịch vụ phù hợp với tiêu chí tìm kiếm' : 'Hãy thêm dịch vụ mới để bắt đầu' }}</p>
    <button class="btn btn-primary" (click)="openCreateForm()">
      <i class="fas fa-plus"></i> Thêm Dịch Vụ Mới
    </button>
  </div>
</div>
